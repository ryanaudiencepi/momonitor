
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>MoMonitor : Monitoring for Developers &mdash; momonitor 0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/flasky.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="momonitor 0.1 documentation" href="#" />
   
  
  <link media="only screen and (max-device-width: 480px)" href="_static/small_flask.css" type= "text/css" rel="stylesheet" />
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li><a href="#">momonitor 0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="momonitor-monitoring-for-developers">
<h1>MoMonitor : Monitoring for Developers<a class="headerlink" href="#momonitor-monitoring-for-developers" title="Permalink to this headline">¶</a></h1>
<p>Release v 0.1</p>
<p>System monitoring shouldn&#8217;t be scary. MoMonitor is here to help.</p>
<p>MoMonitor is a simple <a class="reference external" href="http://www.apache.org/licenses/LICENSE-2.0.html">Apache2 License</a> monitoring solution built by developers, for developers. It was created out of frustration of configuring and maintaining <a class="reference external" href="http://www.nagios.org/">Nagios</a>.</p>
<div class="section" id="why-momonitor">
<h2>Why MoMonitor?<a class="headerlink" href="#why-momonitor" title="Permalink to this headline">¶</a></h2>
<ul>
<li><div class="first line-block">
<div class="line"><strong>Manage your checks via a simple WebUI</strong></div>
<div class="line">Edit, create, and delete system checks with a simple WebUI! No more needing to update foreign configuration files to manage your checks.</div>
</div>
</li>
<li><div class="first line-block">
<div class="line"><strong>Designed for extensibility</strong></div>
<div class="line">Adding new types of health checks is easy as cake. Just create a new django model, and you&#8217;re good!</div>
</div>
</li>
<li><div class="first line-block">
<div class="line"><strong>Know what, when, and why</strong></div>
<div class="line">Know when your checks run, whether they succeeded or failed, and why! MoMonitor gives you an intuitive, human-readable interface for doing so.</div>
</div>
</li>
<li><div class="first line-block">
<div class="line"><strong>Alert via</strong> <a class="reference external" href="http://www.pagerduty.com/">Pagerduty</a> <strong>or generic email</strong></div>
<div class="line">We have implemented builtin support for PagerDuty. Alerts are sent out immediently upon a failed check.</div>
</div>
</li>
<li><div class="first line-block">
<div class="line"><strong>Actively being worked on at</strong> <a class="reference external" href="http://mopub.com">MoPub</a></div>
<div class="line">MoPub uses MoMonitor as its centralized monitoring system. We monitor a system that handles over a billion requests everyday.</div>
</div>
</li>
</ul>
</div>
</div>
<div class="section" id="how-it-works">
<h1>How it works<a class="headerlink" href="#how-it-works" title="Permalink to this headline">¶</a></h1>
<p>MoMonitor is a simple django app that manages and runs health checks on your systems. If a health check fails, MoMonitor will alert you immedietely.</p>
<p>As a developer, you define services and health checks. Services are collections of health checks that share a bunch of defaults (i.e. check frequency, alert type). Several types of health checks have been implemented to help you monitor every aspect of your system.</p>
<p>See the <a class="reference external" href="http://www.youtube.com/watch?v=uL5ddl5wpac">video tutorial</a> for a brief overview of the momonitor WebUI.</p>
<p>We also put together a quick <a class="reference external" href="http://mopub.github.com/momonitor/slideshow">presentation</a> to highlight the goals of momonitor.</p>
<p>Want to start creating checks right away? See the <a class="reference external" href="http://youtu.be/YVNQo98Nrio">demo video</a> about creating checks</p>
</div>
<div class="section" id="getting-started">
<h1>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h1>
<div class="section" id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h2>
<ul>
<li><div class="first line-block">
<div class="line"><strong>PostgreSQL</strong></div>
<div class="line">MoMonitor has only been tested with PostgreSQL, however there isn&#8217;t any reason why it shouldn&#8217;t work with any Django supported backend. (i.e. MySQL, SQLite)</div>
</div>
</li>
<li><div class="first line-block">
<div class="line"><strong>Python</strong></div>
<div class="line">MoMonitor has been tested with Python2.7. Install the requirements included in the requirements file (pip install -r requirements.txt)</div>
</div>
</li>
<li><div class="first line-block">
<div class="line"><strong>Redis</strong></div>
<div class="line">MoMonitor keeps check state in a redis cache. Note that check state is currently not persisent unless you have enabled Redis persistence. This is optional.</div>
</div>
</li>
<li><div class="first line-block">
<div class="line"><strong>Cron</strong></div>
<div class="line">MoMonitor depends on Cron to run the management script.</div>
</div>
</li>
</ul>
<div class="highlight-python"><pre>python manage.py service_check_cron</pre>
</div>
<ul>
<li><div class="first line-block">
<div class="line"><strong>Google OAuth</strong></div>
<div class="line">MoMonitor currently uses OAuth tied with your google account. A more generic authentication method will be implemented in future versions.</div>
<div class="line">You need to set the domain white list to the email address that you use with your gmail account. For example, since we have &#64;mopub.com for MoPub, we use the following configuration:</div>
</div>
</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span class="n">GOOGLE_WHITE_LISTED_DOMAINS</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;mopub.com&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="setup-from-nothing">
<h2>Setup from Nothing<a class="headerlink" href="#setup-from-nothing" title="Permalink to this headline">¶</a></h2>
<p>First clone the Repo:</p>
<div class="highlight-python"><pre>git clone git@github.com:mopub/momonitor.git</pre>
</div>
<p>Next, you will need to setup your database and sync your Django Models. Make sure the database is already running.</p>
<div class="highlight-python"><pre>psql -U postgres -c "CREATE ROLE &lt;role-name&gt; with password '&lt;password&gt;';"
psql -U postgres -c "CREATE DATABASE &lt;database-name&gt; with owner &lt;role-name&gt;;"
python manage.py syncdb
python manage.py migrate</pre>
</div>
<p>Update Section 2 of the settings.py file with your database configurations</p>
<div class="highlight-python"><pre>  DATABASES = {
     'default': {
        'ENGINE': 'django.db.backends.postgresql_psycopg2',
        'NAME': '&lt;database-name&gt;',
        'USER': '&lt;role-name&gt;',
        'PASSWORD': '&lt;password&gt;',
        'HOST': 'localhost',
        'PORT': '5432',
    }
}</pre>
</div>
<p>(optional) Set Variables required for certain types of checks</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">UMPIRE_ENDPOINT</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
<span class="n">SENSU_API_ENDPOINT</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
<span class="n">GRAPHITE_ENDPOINT</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>

<span class="c">#OAuth rule. Only allow people with a google email ending in &#39;example.org&#39; to access the site</span>
<span class="n">GOOGLE_WHITE_LISTED_DOMAINS</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;gmail.com&#39;</span><span class="p">]</span>

<span class="c"># Set this to the Domain of the site that will be hosting momonitor</span>
<span class="n">DOMAIN</span> <span class="o">=</span> <span class="s">&quot;http://localhost&quot;</span>

<span class="c">#By default, all checks are enabled. Select only a few checks by defining this variable</span>
<span class="n">CHECK_MODELS</span><span class="o">=</span><span class="p">[]</span>
</pre></div>
</div>
<p>Start the server</p>
<div class="highlight-python"><pre>python manage.py runserver</pre>
</div>
<p>Configure Cron to Run. Cron should <strong>run the service_check_cron every minute</strong> to keep MoMonitor up to date. While this is not the most efficient way to keep checks runnning, it has worked for MoPub so far.</p>
<p><strong>/etc/cron.d/mycron</strong></p>
<div class="highlight-python"><pre>* * * * * &lt;user&gt; python &lt;path-to-repo&gt;/momonitor/manage.py service_check_cron</pre>
</div>
<p>And, you&#8217;re ready to go!</p>
</div>
</div>
<div class="section" id="overview">
<h1>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h1>
<div class="section" id="what-it-is">
<h2>What it is<a class="headerlink" href="#what-it-is" title="Permalink to this headline">¶</a></h2>
<p>MoMonitor is a Django app that runs on a PostgreSQL backend and Redis Cache. Check and service configurations are kept in Postgres while application state is kept in Redis. MoMonitor is configured to use Google OAuth for authentication via django-social-auth. MoMonitor relies on cron to run checks.</p>
<p>Essentially two types of objects exist in MoMonitor: services and service checks. Service checks that test like parts of your infrastructure are grouped into single service. Services provide defaults and alerts for the checks they contain.</p>
</div>
<div class="section" id="types-of-checks">
<h2>Types of Checks<a class="headerlink" href="#types-of-checks" title="Permalink to this headline">¶</a></h2>
<p>One of the great advantages of MoMonitor is the ability to easily define new types of checks. At MoPub, we have already defined several types of checks:</p>
<ul>
<li><div class="first line-block">
<div class="line"><strong>Simple Check</strong></div>
<div class="line">checks a single HTTP endpoint and reports whether the HTTP response returned with a 200 or non-200 status code.</div>
</div>
</li>
<li><div class="first line-block">
<div class="line"><strong>Umpire Check</strong></div>
<div class="line">implements the Umpire API to report on graphite data. Umpire checks require an <a class="reference external" href="https://github.com/heroku/umpire">Umpire</a> Server and <a class="reference external" href="http://graphite.wikidot.com/">Graphite</a> Server. To integrate with MoMonitor you need to add the follwing settings constants with the URL endpoints of your servers...</div>
</div>
</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span class="n">UMPIRE_ENDPOINT</span> <span class="o">=</span> <span class="s">&quot;http://example.org/check&quot;</span>
<span class="n">GRAPHITE_ENDPOINT</span> <span class="o">=</span> <span class="s">&quot;http://example.org&quot;</span>
</pre></div>
</div>
<ul>
<li><div class="first line-block">
<div class="line"><strong>Compare Check</strong></div>
<div class="line">hits an HTTP endpoint that returns serialized data in the response body (i.e. json). Specify a field in the serialized data using dot notation, and compare the value of that field to a value that your specify.</div>
</div>
</li>
<li><div class="first line-block">
<div class="line"><strong>Code Check</strong></div>
<div class="line">runs code (that you upload) on the momonitor server. Currently only Python is supported.</div>
</div>
</li>
<li><div class="first line-block">
<div class="line"><strong>Sensu Check</strong></div>
<div class="line">implements the Sensu Aggregate API and alerts when any servers fail a sensu check.</div>
<div class="line">Sensu checks require a <a class="reference external" href="https://github.com/sensu/sensu">Sensu</a> Server. To integrate with MoMonitor...</div>
</div>
</li>
<li><div class="first line-block">
<div class="line"><strong>Graphite Check</strong></div>
<div class="line">Emulates the function of Umpire. Apply a minimum and maximum threshold on a graphite metric, and get alerted when the value goes beyond those thresholds.</div>
</div>
</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span class="n">SENSU_API_ENDPOINT</span> <span class="o">=</span> <span class="s">&quot;http://example.org:4567&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="extra-check-options">
<h2>Extra Check Options<a class="headerlink" href="#extra-check-options" title="Permalink to this headline">¶</a></h2>
<ul>
<li><div class="first line-block">
<div class="line"><strong>Frequency</strong></div>
<div class="line">Cron-like interface to specify how often you would like your check to run</div>
</div>
</li>
<li><div class="first line-block">
<div class="line"><strong>Failures before alert</strong></div>
<div class="line">Number of consecutive failures to occur before an alert is sent</div>
</div>
</li>
<li><div class="first line-block">
<div class="line"><strong>Silenced</strong></div>
<div class="line">If a check is silenced, it will not send alerts even if it is failing</div>
</div>
</li>
</ul>
</div>
<div class="section" id="check-statuses">
<h2>Check Statuses<a class="headerlink" href="#check-statuses" title="Permalink to this headline">¶</a></h2>
<ul>
<li><div class="first line-block">
<div class="line"><strong>Good</strong></div>
<div class="line">The last check was passing</div>
</div>
</li>
<li><div class="first line-block">
<div class="line"><strong>Bad</strong></div>
<div class="line">The check has failed at least X times (default 1). This value is configurable via the &#8220;Failures Before Alert&#8221; option</div>
</div>
</li>
<li><div class="first line-block">
<div class="line"><strong>Unknown</strong></div>
<div class="line">The service / endpoint providing the check either failed or gave a non-valid response</div>
</div>
</li>
</ul>
</div>
<div class="section" id="types-of-alerts">
<h2>Types of Alerts<a class="headerlink" href="#types-of-alerts" title="Permalink to this headline">¶</a></h2>
<ul>
<li><div class="first line-block">
<div class="line"><strong>Email</strong></div>
<div class="line">Email alerts will send an an email to the specified contact upon a check failing</div>
</div>
</li>
<li><div class="first line-block">
<div class="line"><strong>Pagerduty</strong></div>
<div class="line">Pagerduty alerts will trigger an event to the specified Pagerduty service key upon a check failing</div>
</div>
</li>
<li><div class="first line-block">
<div class="line"><strong>None</strong></div>
<div class="line">This option will disable alerts for the service</div>
</div>
</li>
</ul>
</div>
</div>
<div class="section" id="other-features">
<h1>Other Features<a class="headerlink" href="#other-features" title="Permalink to this headline">¶</a></h1>
<p>MoMonitor comes with a couple additional features that make it more fun. These are by no means neccessary, but they continue to help us at MoPub</p>
<ul>
<li><div class="first line-block">
<div class="line"><strong>Mobile UI</strong></div>
<div class="line">On the go? Enable the momonitor/mobile django app to get access to MoMonitor&#8217;s mobile interface. Currently, the interface allows you to view the health of all checks and silence them if neccessary.</div>
</div>
</li>
<li><div class="first line-block">
<div class="line"><strong>Slideshow</strong></div>
<div class="line">Have an extra unused TV hanging on the wall? Enable the momonitor/slideshow django app to get access to MoMonitor&#8217;s slideshow feature. Based on all of the checks you add, MoMonitor will automatically create a slideshow for each service, which cycles through graphs of all of your checks.</div>
</div>
</li>
</ul>
</div>
<div class="section" id="testing">
<h1>Testing<a class="headerlink" href="#testing" title="Permalink to this headline">¶</a></h1>
<p>For testing, we are using Django&#8217;s builtin unittest.TestCase and a custom-made Flask http server to mimic external services (like Sensu and Umpire). To run tests, you must start up the flask server before running the test command:</p>
<div class="highlight-python"><pre>$ python manage.py start_testing_faux_server</pre>
</div>
<p>And then, in a separate tab...</p>
<div class="highlight-python"><pre>$ python manage test main
$ python manage test mobile</pre>
</div>
</div>
<div class="section" id="feedback">
<h1>Feedback<a class="headerlink" href="#feedback" title="Permalink to this headline">¶</a></h1>
<p>We love feedback. If you have any questions about the momonitoring system, contact Rob at <a class="reference external" href="mailto:rob&#37;&#52;&#48;mopub&#46;com">rob<span>&#64;</span>mopub<span>&#46;</span>com</a></p>
<p>Found an issue? We&#8217;d greatly appreciate it you <a class="reference external" href="https://github.com/mopub/momonitor/issues">told us</a> !</p>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="#">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">MoMonitor : Monitoring for Developers</a><ul>
<li><a class="reference internal" href="#why-momonitor">Why MoMonitor?</a></li>
</ul>
</li>
<li><a class="reference internal" href="#how-it-works">How it works</a></li>
<li><a class="reference internal" href="#getting-started">Getting Started</a><ul>
<li><a class="reference internal" href="#requirements">Requirements</a></li>
<li><a class="reference internal" href="#setup-from-nothing">Setup from Nothing</a></li>
</ul>
</li>
<li><a class="reference internal" href="#overview">Overview</a><ul>
<li><a class="reference internal" href="#what-it-is">What it is</a></li>
<li><a class="reference internal" href="#types-of-checks">Types of Checks</a></li>
<li><a class="reference internal" href="#extra-check-options">Extra Check Options</a></li>
<li><a class="reference internal" href="#check-statuses">Check Statuses</a></li>
<li><a class="reference internal" href="#types-of-alerts">Types of Alerts</a></li>
</ul>
</li>
<li><a class="reference internal" href="#other-features">Other Features</a></li>
<li><a class="reference internal" href="#testing">Testing</a></li>
<li><a class="reference internal" href="#feedback">Feedback</a></li>
</ul>
<h3>Related Topics</h3>
<ul>
  <li><a href="#">Documentation overview</a><ul>
  </ul></li>
</ul>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/index.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy; Copyright 2013, Rob McQueen.
    </div>
  </body>
</html>